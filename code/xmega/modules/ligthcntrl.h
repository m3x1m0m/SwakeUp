/////////////////////////////////////////////////////////////////////////////////
// Light controller, which simple allows to post colors with a duration to a
// queue and takes care of execution.
//
// Author:				Maximilian Stiefel
// Last Modification:	25.05.2017
/////////////////////////////////////////////////////////////////////////////////

#ifndef XMEGA_MODULES_LIGTHCNTRL_H_
#define XMEGA_MODULES_LIGTHCNTRL_H_

/////////////////////////////////////////////////////////////////////////////////
// Includes
/////////////////////////////////////////////////////////////////////////////////
#include <avr/io.h>
#include "../util/fixedpoint.h"

/////////////////////////////////////////////////////////////////////////////////
// Defines
/////////////////////////////////////////////////////////////////////////////////
#define QUEUE_LENGTH 128

/////////////////////////////////////////////////////////////////////////////////
// Typedefs
/////////////////////////////////////////////////////////////////////////////////
typedef struct myrgbcolor_t
{
	uint16_t duration;					// Duration as tics, right now 100 ms = 1 tick
	uint16_t red;
	uint16_t blue;
	uint16_t green;	
	uint8_t gain;						// Gain on every color
	uint8_t smoothing;					// Smoothing between this color and the next color
	char name[32];						// Name of the color  
} myrgbcolor_t;

/////////////////////////////////////////////////////////////////////////////////
// Macros
/////////////////////////////////////////////////////////////////////////////////
#define STRINGIFY(x) #x
#define TOSTRING(x) STRINGIFY(x)

#define CREATE_NEW_COLOR(DURATION, RED, BLUE, GREEN, GAIN, SMOOTH, COL_NAME)\
	myrgbcolor_t COL_NAME = {DURATION*10, RED, BLUE, GREEN, GAIN, SMOOTH, TOSTRING(COL_NAME)}

/////////////////////////////////////////////////////////////////////////////////
// Prototypes
/////////////////////////////////////////////////////////////////////////////////
uint8_t addToLigthPattern(myrgbcolor_t *color);
void enableLightCnt(uint8_t repeat);
void disableLightCnt();

#endif /* XMEGA_MODULES_LIGTHCNTRL_H_ */